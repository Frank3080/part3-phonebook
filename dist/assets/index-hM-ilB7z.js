var p={};const m=require("express"),o=m(),c=require("body-parser"),i=require("morgan"),l=require("cors");o.use(l());o.use(m.json());i.token("postData",n=>n.method==="POST"&&n.body?JSON.stringify(n.body):" ");const b=":method :url :status :res[content-length] - :response-time ms :postData";o.use(i(":method :url :status :res[content-length] - :response-time ms"));o.use(i(b));o.use(c.json());let t=[{id:1,name:"Arto Hellas",number:"040-123456"},{id:2,name:"Ada Lovelace",number:"39-44-5323523"},{id:3,name:"Dan Abramov",number:"12-43-234245"},{id:4,name:"Mary poppendick",number:"39-23-6423122"}];o.get("/api/persons",(n,e)=>{e.json(t)});o.get("/api/persons/:id",(n,e)=>{const s=Number(n.params.id),r=t.find(a=>a.id===s);e.json(r),r||e.status(404).end()});o.delete("/api/persons/:id",(n,e)=>{const s=Number(n.params.id);t=t.filter(r=>r.id!==s),e.status(204).end()});o.post("/api/persons",(n,e)=>{const s=n.body;if(!s.name||!s.number)return e.status(400).json({error:"You have to put name and number"});if(t.some(d=>d.name===s.name))return e.status(400).json({error:"Name already exists"});const a={id:f(),name:s.name,number:s.number};t=t.concat(a),e.json(a)});o.get("/info",(n,e)=>{const s=new Date;e.send(`<p>Phonebook has info for ${t.length} people</p> <p>${s}</p>`)});function f(){return Math.floor(Math.random()*1e6)}const u=p.PORT||3001;o.listen(u,()=>{console.log(`Server is running on port ${u}`)});
